<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Express-app Setting</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Express-app Setting</h1>

  <form id="userForm">
    <h3>ğŸ””ì•Œë¦¼ë©”ì„¸ì§€ ë„ê¸°ğŸš«</h3><br>
    <div class="toggle">
      <input type="checkbox" id="user1" name="user" value="ì§€ì„ê·œ">
      <span class="slider" onclick="toggleCheckbox('user1')"></span>
      <span class="label-text">ì§€ì„ê·œ</span>
    </div>
    <div class="toggle">
      <input type="checkbox" id="user2" name="user" value="ì´íš¨íƒ">
      <span class="slider" onclick="toggleCheckbox('user2')"></span>
      <span class="label-text">ì´íš¨íƒ</span>
    </div>
    <div class="toggle">
      <input type="checkbox" id="user3" name="user" value="ìœ í˜¸">
      <span class="slider" onclick="toggleCheckbox('user3')"></span>
      <span class="label-text">ìœ í˜¸</span>
    </div>
    <div class="toggle">
      <input type="checkbox" id="user4" name="user" value="ê¹€ì§€ìœ¤">
      <span class="slider" onclick="toggleCheckbox('user4')"></span>
      <span class="label-text">ê¹€ì§€ìœ¤</span>
    </div>
    <div class="toggle">
      <input type="checkbox" id="user5" name="user" value="ë°•ì„±ì¤‘">
      <span class="slider" onclick="toggleCheckbox('user5')"></span>
      <span class="label-text">ë°•ì„±ì¤‘</span>
    </div>
    <div class="toggle">
      <input type="checkbox" id="user6" name="user" value="ë°•ìœ ë¦¼">
      <span class="slider" onclick="toggleCheckbox('user6')"></span>
      <span class="label-text">ë°•ìœ ë¦¼</span>
    </div>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
    // í˜ì´ì§€ ë¡œë”©ì´ ì™„ë£Œë˜ë©´ ì„œë²„ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ í† ê¸€ ìŠ¤ìœ„ì¹˜ì— ë°˜ì˜
    fetch('/users')
      .then(response => response.json())
      .then(data => {
          // ê°€ì ¸ì˜¨ ì‚¬ìš©ì ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ í† ê¸€ ìŠ¤ìœ„ì¹˜ ì„¤ì •
          console.log('Response:', data);
          data.users.forEach(user => {
              // ì‚¬ìš©ì ì •ë³´ì— ë”°ë¼ í† ê¸€ ìŠ¤ìœ„ì¹˜ ì„¤ì •
              const userSwitch = document.querySelector(`input[value="${user.user}"]`);
              if (userSwitch) {
                  userSwitch.checked = user.value === 'true';
              }
          });
      })
      .catch(error => {
        console.error('Error fetching user data:', error);
      });
    });

    function toggleCheckbox(id) {
      const checkbox = document.getElementById(id);
      checkbox.checked = !checkbox.checked;
      checkbox.dispatchEvent(new Event('change'));
    }

  document.querySelectorAll('input[type="checkbox"][name="user"]').forEach((checkbox) => {
  checkbox.addEventListener('change', function() {
    // í˜„ì¬ ìŠ¤ìœ„ì¹˜ì˜ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§Œ ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡
    if (this.checked) {
      sendData(this.value, 'true');
      // í˜„ì¬ ìŠ¤ìœ„ì¹˜ë¥¼ ì œì™¸í•œ ë‹¤ë¥¸ ìŠ¤ìœ„ì¹˜ì˜ ìƒíƒœë¥¼ í•´ì œí•¨
      //document.querySelectorAll('input[type="checkbox"][name="user"]').forEach((cb) => {
      //  if (cb !== this) cb.checked = false;
      //});
    } else {
      sendData(this.value, 'false');
    }
  });
});

    function sendData(user, value) {
      // ë³´ë‚¼ JSON ë°ì´í„°
      const data = {
        user: user,
        role: 'mute',
        value: value
      };

      console.log(data);

      // POST ìš”ì²­ ì„¤ì •
      fetch('/set', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        console.log('ì‘ë‹µ:', data);
      })
      .catch(error => {
        console.error('ì˜¤ë¥˜:', error);
      });
    }
  </script>
</body>
</html>
